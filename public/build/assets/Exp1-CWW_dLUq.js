var Nt=Object.defineProperty;var kt=(i,t,a)=>t in i?Nt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[t]=a;var ue=(i,t,a)=>kt(i,typeof t!="symbol"?t+"":t,a);import{r as B,j as te,S as Lt}from"./app-D1vrtom9.js";import{C as Pt,O as Ht}from"./OrbitControls-DZC9jphz.js";import{N as zt}from"./Navbar-B_Z2ZuT2.js";import{_ as Wr}from"./extends-CF3RwP-h.js";import{M as pr,I as Gt,S as ar,D as Zt,a as $r,H as Te,F as Ne,b as We,L as Fe,R as nr,c as Wt,C as Pe,d as Xr,O as $t,P as xr,W as hr,U as dr,e as Xt,f as jt,g as yr,T as $e,h as Yt,i as Vt,j as qt,B as Kt,k as Qt,l as Er,m as Jt,n as ea,o as zr,p as ra,q as vr,N as ta,V as Je,u as Ge,r as fr,s as aa,E as na,t as ia,v as sa,w as oa,x as Ir,y as la,z as Gr,A as ca,G as ua}from"./events-776716bd.esm-DqYEZJyz.js";import{v as jr}from"./constants-D5g3GJ15.js";import{F as va}from"./Float-CSTWjR8k.js";var Ce=Uint8Array,He=Uint16Array,Mr=Uint32Array,Yr=new Ce([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Vr=new Ce([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ha=new Ce([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),qr=function(i,t){for(var a=new He(31),o=0;o<31;++o)a[o]=t+=1<<i[o-1];for(var l=new Mr(a[30]),o=1;o<30;++o)for(var h=a[o];h<a[o+1];++h)l[h]=h-a[o]<<5|o;return[a,l]},Kr=qr(Yr,2),Qr=Kr[0],da=Kr[1];Qr[28]=258,da[258]=28;var fa=qr(Vr,0),pa=fa[0],Sr=new He(32768);for(var ie=0;ie<32768;++ie){var Le=(ie&43690)>>>1|(ie&21845)<<1;Le=(Le&52428)>>>2|(Le&13107)<<2,Le=(Le&61680)>>>4|(Le&3855)<<4,Sr[ie]=((Le&65280)>>>8|(Le&255)<<8)>>>1}var tr=function(i,t,a){for(var o=i.length,l=0,h=new He(t);l<o;++l)++h[i[l]-1];var v=new He(t);for(l=0;l<t;++l)v[l]=v[l-1]+h[l-1]<<1;var p;if(a){p=new He(1<<t);var f=15-t;for(l=0;l<o;++l)if(i[l])for(var m=l<<4|i[l],b=t-i[l],T=v[i[l]-1]++<<b,U=T|(1<<b)-1;T<=U;++T)p[Sr[T]>>>f]=m}else for(p=new He(o),l=0;l<o;++l)i[l]&&(p[l]=Sr[v[i[l]-1]++]>>>15-i[l]);return p},sr=new Ce(288);for(var ie=0;ie<144;++ie)sr[ie]=8;for(var ie=144;ie<256;++ie)sr[ie]=9;for(var ie=256;ie<280;++ie)sr[ie]=7;for(var ie=280;ie<288;++ie)sr[ie]=8;var Jr=new Ce(32);for(var ie=0;ie<32;++ie)Jr[ie]=5;var ga=tr(sr,9,1),ma=tr(Jr,5,1),wr=function(i){for(var t=i[0],a=1;a<i.length;++a)i[a]>t&&(t=i[a]);return t},Re=function(i,t,a){var o=t/8|0;return(i[o]|i[o+1]<<8)>>(t&7)&a},_r=function(i,t){var a=t/8|0;return(i[a]|i[a+1]<<8|i[a+2]<<16)>>(t&7)},wa=function(i){return(i/8|0)+(i&7&&1)},_a=function(i,t,a){(a==null||a>i.length)&&(a=i.length);var o=new(i instanceof He?He:i instanceof Mr?Mr:Ce)(a-t);return o.set(i.subarray(t,a)),o},ya=function(i,t,a){var o=i.length;if(!o||a&&!a.l&&o<5)return t||new Ce(0);var l=!t||a,h=!a||a.i;a||(a={}),t||(t=new Ce(o*3));var v=function(K){var De=t.length;if(K>De){var Be=new Ce(Math.max(De*2,K));Be.set(t),t=Be}},p=a.f||0,f=a.p||0,m=a.b||0,b=a.l,T=a.d,U=a.m,k=a.n,z=o*8;do{if(!b){a.f=p=Re(i,f,1);var se=Re(i,f+1,3);if(f+=3,se)if(se==1)b=ga,T=ma,U=9,k=5;else if(se==2){var ae=Re(i,f,31)+257,ve=Re(i,f+10,15)+4,W=ae+Re(i,f+5,31)+1;f+=14;for(var A=new Ce(W),Y=new Ce(19),M=0;M<ve;++M)Y[ha[M]]=Re(i,f+M*3,7);f+=ve*3;for(var S=wr(Y),H=(1<<S)-1,$=tr(Y,S,1),M=0;M<W;){var L=$[Re(i,f,H)];f+=L&15;var O=L>>>4;if(O<16)A[M++]=O;else{var G=0,C=0;for(O==16?(C=3+Re(i,f,3),f+=2,G=A[M-1]):O==17?(C=3+Re(i,f,7),f+=3):O==18&&(C=11+Re(i,f,127),f+=7);C--;)A[M++]=G}}var q=A.subarray(0,ae),D=A.subarray(ae);U=wr(q),k=wr(D),b=tr(q,U,1),T=tr(D,k,1)}else throw"invalid block type";else{var O=wa(f)+4,Z=i[O-4]|i[O-3]<<8,X=O+Z;if(X>o){if(h)throw"unexpected EOF";break}l&&v(m+Z),t.set(i.subarray(O,X),m),a.b=m+=Z,a.p=f=X*8;continue}if(f>z){if(h)throw"unexpected EOF";break}}l&&v(m+131072);for(var Ee=(1<<U)-1,Se=(1<<k)-1,_e=f;;_e=f){var G=b[_r(i,f)&Ee],V=G>>>4;if(f+=G&15,f>z){if(h)throw"unexpected EOF";break}if(!G)throw"invalid length/literal";if(V<256)t[m++]=V;else if(V==256){_e=f,b=null;break}else{var me=V-254;if(V>264){var M=V-257,oe=Yr[M];me=Re(i,f,(1<<oe)-1)+Qr[M],f+=oe}var fe=T[_r(i,f)&Se],Ue=fe>>>4;if(!fe)throw"invalid distance";f+=fe&15;var D=pa[Ue];if(Ue>3){var oe=Vr[Ue];D+=_r(i,f)&(1<<oe)-1,f+=oe}if(f>z){if(h)throw"unexpected EOF";break}l&&v(m+131072);for(var je=m+me;m<je;m+=4)t[m]=t[m-D],t[m+1]=t[m+1-D],t[m+2]=t[m+2-D],t[m+3]=t[m+3-D];m=je}}a.l=b,a.p=_e,a.b=m,b&&(p=1,a.m=U,a.d=T,a.n=k)}while(!p);return m==t.length?t:_a(t,0,m)},Ea=new Ce(0),Ma=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function cr(i,t){return ya((Ma(i),i.subarray(2,-4)),t)}var Sa=typeof TextDecoder<"u"&&new TextDecoder,xa=0;try{Sa.decode(Ea,{stream:!0}),xa=1}catch{}const Ia=i=>i&&i.isCubeTexture;class ba extends pr{constructor(t,a){var o,l;const h=Ia(t),p=((l=h?(o=t.image[0])==null?void 0:o.width:t.image.width)!=null?l:1024)/4,f=Math.floor(Math.log2(p)),m=Math.pow(2,f),b=3*Math.max(m,16*7),T=4*m,U=[h?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/b}`,`#define CUBEUV_TEXEL_HEIGHT ${1/T}`,`#define CUBEUV_MAX_MIP ${f}.0`],k=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,z=U.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${jr>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,se={map:{value:t},height:{value:(a==null?void 0:a.height)||15},radius:{value:(a==null?void 0:a.radius)||100}},O=new Gt(1,16),Z=new ar({uniforms:se,fragmentShader:z,vertexShader:k,side:Zt});super(O,Z)}set radius(t){this.material.uniforms.radius.value=t}get radius(){return this.material.uniforms.radius.value}set height(t){this.material.uniforms.height.value=t}get height(){return this.material.uniforms.height.value}}const Ca={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},Ta={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `};class Ra extends $r{constructor(t){super(t),this.type=Te}parse(t){const v=function(M,S){switch(M){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(S||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(S||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(S||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(S||""))}},b=`
`,T=function(M,S,H){S=S||1024;let L=M.pos,G=-1,C=0,q="",D=String.fromCharCode.apply(null,new Uint16Array(M.subarray(L,L+128)));for(;0>(G=D.indexOf(b))&&C<S&&L<M.byteLength;)q+=D,C+=D.length,L+=128,D+=String.fromCharCode.apply(null,new Uint16Array(M.subarray(L,L+128)));return-1<G?(M.pos+=C+G+1,q+D.slice(0,G)):!1},U=function(M){const S=/^#\?(\S+)/,H=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,$=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,L=/^\s*FORMAT=(\S+)\s*$/,G=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,C={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let q,D;for((M.pos>=M.byteLength||!(q=T(M)))&&v(1,"no header found"),(D=q.match(S))||v(3,"bad initial token"),C.valid|=1,C.programtype=D[1],C.string+=q+`
`;q=T(M),q!==!1;){if(C.string+=q+`
`,q.charAt(0)==="#"){C.comments+=q+`
`;continue}if((D=q.match(H))&&(C.gamma=parseFloat(D[1])),(D=q.match($))&&(C.exposure=parseFloat(D[1])),(D=q.match(L))&&(C.valid|=2,C.format=D[1]),(D=q.match(G))&&(C.valid|=4,C.height=parseInt(D[1],10),C.width=parseInt(D[2],10)),C.valid&2&&C.valid&4)break}return C.valid&2||v(3,"missing format specifier"),C.valid&4||v(3,"missing image size specifier"),C},k=function(M,S,H){const $=S;if($<8||$>32767||M[0]!==2||M[1]!==2||M[2]&128)return new Uint8Array(M);$!==(M[2]<<8|M[3])&&v(3,"wrong scanline width");const L=new Uint8Array(4*S*H);L.length||v(4,"unable to allocate buffer space");let G=0,C=0;const q=4*$,D=new Uint8Array(4),Ee=new Uint8Array(q);let Se=H;for(;Se>0&&C<M.byteLength;){C+4>M.byteLength&&v(1),D[0]=M[C++],D[1]=M[C++],D[2]=M[C++],D[3]=M[C++],(D[0]!=2||D[1]!=2||(D[2]<<8|D[3])!=$)&&v(3,"bad rgbe scanline format");let _e=0,V;for(;_e<q&&C<M.byteLength;){V=M[C++];const oe=V>128;if(oe&&(V-=128),(V===0||_e+V>q)&&v(3,"bad scanline data"),oe){const fe=M[C++];for(let Ue=0;Ue<V;Ue++)Ee[_e++]=fe}else Ee.set(M.subarray(C,C+V),_e),_e+=V,C+=V}const me=$;for(let oe=0;oe<me;oe++){let fe=0;L[G]=Ee[oe+fe],fe+=$,L[G+1]=Ee[oe+fe],fe+=$,L[G+2]=Ee[oe+fe],fe+=$,L[G+3]=Ee[oe+fe],G+=4}Se--}return L},z=function(M,S,H,$){const L=M[S+3],G=Math.pow(2,L-128)/255;H[$+0]=M[S+0]*G,H[$+1]=M[S+1]*G,H[$+2]=M[S+2]*G,H[$+3]=1},se=function(M,S,H,$){const L=M[S+3],G=Math.pow(2,L-128)/255;H[$+0]=We.toHalfFloat(Math.min(M[S+0]*G,65504)),H[$+1]=We.toHalfFloat(Math.min(M[S+1]*G,65504)),H[$+2]=We.toHalfFloat(Math.min(M[S+2]*G,65504)),H[$+3]=We.toHalfFloat(1)},O=new Uint8Array(t);O.pos=0;const Z=U(O),X=Z.width,ae=Z.height,ve=k(O.subarray(O.pos),X,ae);let W,A,Y;switch(this.type){case Ne:Y=ve.length/4;const M=new Float32Array(Y*4);for(let H=0;H<Y;H++)z(ve,H*4,M,H*4);W=M,A=Ne;break;case Te:Y=ve.length/4;const S=new Uint16Array(Y*4);for(let H=0;H<Y;H++)se(ve,H*4,S,H*4);W=S,A=Te;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:X,height:ae,data:W,header:Z.string,gamma:Z.gamma,exposure:Z.exposure,type:A}}setDataType(t){return this.type=t,this}load(t,a,o,l){function h(v,p){switch(v.type){case Ne:case Te:"colorSpace"in v?v.colorSpace="srgb-linear":v.encoding=3e3,v.minFilter=Fe,v.magFilter=Fe,v.generateMipmaps=!1,v.flipY=!0;break}a&&a(v,p)}return super.load(t,h,o,l)}}const er=jr>=152;class Ua extends $r{constructor(t){super(t),this.type=Te}parse(t){const S=Math.pow(2.7182818,2.2);function H(e,r){for(var n=0,s=0;s<65536;++s)(s==0||e[s>>3]&1<<(s&7))&&(r[n++]=s);for(var c=n-1;n<65536;)r[n++]=0;return c}function $(e){for(var r=0;r<16384;r++)e[r]={},e[r].len=0,e[r].lit=0,e[r].p=null}const L={l:0,c:0,lc:0};function G(e,r,n,s,c){for(;n<e;)r=r<<8|Pr(s,c),n+=8;n-=e,L.l=r>>n&(1<<e)-1,L.c=r,L.lc=n}const C=new Array(59);function q(e){for(var r=0;r<=58;++r)C[r]=0;for(var r=0;r<65537;++r)C[e[r]]+=1;for(var n=0,r=58;r>0;--r){var s=n+C[r]>>1;C[r]=n,n=s}for(var r=0;r<65537;++r){var c=e[r];c>0&&(e[r]=c|C[c]++<<6)}}function D(e,r,n,s,c,u,g){for(var d=n,y=0,_=0;c<=u;c++){if(d.value-n.value>s)return!1;G(6,y,_,e,d);var E=L.l;if(y=L.c,_=L.lc,g[c]=E,E==63){if(d.value-n.value>s)throw"Something wrong with hufUnpackEncTable";G(8,y,_,e,d);var w=L.l+6;if(y=L.c,_=L.lc,c+w>u+1)throw"Something wrong with hufUnpackEncTable";for(;w--;)g[c++]=0;c--}else if(E>=59){var w=E-59+2;if(c+w>u+1)throw"Something wrong with hufUnpackEncTable";for(;w--;)g[c++]=0;c--}}q(g)}function Ee(e){return e&63}function Se(e){return e>>6}function _e(e,r,n,s){for(;r<=n;r++){var c=Se(e[r]),u=Ee(e[r]);if(c>>u)throw"Invalid table entry";if(u>14){var g=s[c>>u-14];if(g.len)throw"Invalid table entry";if(g.lit++,g.p){var d=g.p;g.p=new Array(g.lit);for(var y=0;y<g.lit-1;++y)g.p[y]=d[y]}else g.p=new Array(1);g.p[g.lit-1]=r}else if(u)for(var _=0,y=1<<14-u;y>0;y--){var g=s[(c<<14-u)+_];if(g.len||g.p)throw"Invalid table entry";g.len=u,g.lit=r,_++}}return!0}const V={c:0,lc:0};function me(e,r,n,s){e=e<<8|Pr(n,s),r+=8,V.c=e,V.lc=r}const oe={c:0,lc:0};function fe(e,r,n,s,c,u,g,d,y,_){if(e==r){s<8&&(me(n,s,c,g),n=V.c,s=V.lc),s-=8;var E=n>>s,E=new Uint8Array([E])[0];if(y.value+E>_)return!1;for(var w=d[y.value-1];E-- >0;)d[y.value++]=w}else if(y.value<_)d[y.value++]=e;else return!1;oe.c=n,oe.lc=s}function Ue(e){return e&65535}function je(e){var r=Ue(e);return r>32767?r-65536:r}const K={a:0,b:0};function De(e,r){var n=je(e),s=je(r),c=s,u=n+(c&1)+(c>>1),g=u,d=u-c;K.a=g,K.b=d}function Be(e,r){var n=Ue(e),s=Ue(r),c=n-(s>>1)&65535,u=s+c-32768&65535;K.a=u,K.b=c}function st(e,r,n,s,c,u,g){for(var d=g<16384,y=n>c?c:n,_=1,E;_<=y;)_<<=1;for(_>>=1,E=_,_>>=1;_>=1;){for(var w=0,ce=w+u*(c-E),I=u*_,R=u*E,F=s*_,N=s*E,Q,ee,he,we;w<=ce;w+=R){for(var re=w,Ae=w+s*(n-E);re<=Ae;re+=N){var ne=re+F,de=re+I,Oe=de+F;d?(De(e[re+r],e[de+r]),Q=K.a,he=K.b,De(e[ne+r],e[Oe+r]),ee=K.a,we=K.b,De(Q,ee),e[re+r]=K.a,e[ne+r]=K.b,De(he,we),e[de+r]=K.a,e[Oe+r]=K.b):(Be(e[re+r],e[de+r]),Q=K.a,he=K.b,Be(e[ne+r],e[Oe+r]),ee=K.a,we=K.b,Be(Q,ee),e[re+r]=K.a,e[ne+r]=K.b,Be(he,we),e[de+r]=K.a,e[Oe+r]=K.b)}if(n&_){var de=re+I;d?De(e[re+r],e[de+r]):Be(e[re+r],e[de+r]),Q=K.a,e[de+r]=K.b,e[re+r]=Q}}if(c&_)for(var re=w,Ae=w+s*(n-E);re<=Ae;re+=N){var ne=re+F;d?De(e[re+r],e[ne+r]):Be(e[re+r],e[ne+r]),Q=K.a,e[ne+r]=K.b,e[re+r]=Q}E=_,_>>=1}return w}function ot(e,r,n,s,c,u,g,d,y,_){for(var E=0,w=0,ce=d,I=Math.trunc(c.value+(u+7)/8);c.value<I;)for(me(E,w,n,c),E=V.c,w=V.lc;w>=14;){var R=E>>w-14&16383,F=r[R];if(F.len)w-=F.len,fe(F.lit,g,E,w,n,s,c,y,_,ce),E=oe.c,w=oe.lc;else{if(!F.p)throw"hufDecode issues";var N;for(N=0;N<F.lit;N++){for(var Q=Ee(e[F.p[N]]);w<Q&&c.value<I;)me(E,w,n,c),E=V.c,w=V.lc;if(w>=Q&&Se(e[F.p[N]])==(E>>w-Q&(1<<Q)-1)){w-=Q,fe(F.p[N],g,E,w,n,s,c,y,_,ce),E=oe.c,w=oe.lc;break}}if(N==F.lit)throw"hufDecode issues"}}var ee=8-u&7;for(E>>=ee,w-=ee;w>0;){var F=r[E<<14-w&16383];if(F.len)w-=F.len,fe(F.lit,g,E,w,n,s,c,y,_,ce),E=oe.c,w=oe.lc;else throw"hufDecode issues"}return!0}function Dr(e,r,n,s,c,u){var g={value:0},d=n.value,y=ye(r,n),_=ye(r,n);n.value+=4;var E=ye(r,n);if(n.value+=4,y<0||y>=65537||_<0||_>=65537)throw"Something wrong with HUF_ENCSIZE";var w=new Array(65537),ce=new Array(16384);$(ce);var I=s-(n.value-d);if(D(e,r,n,I,y,_,w),E>8*(s-(n.value-d)))throw"Something wrong with hufUncompress";_e(w,y,_,ce),ot(w,ce,e,r,n,E,_,u,c,g)}function lt(e,r,n){for(var s=0;s<n;++s)r[s]=e[r[s]]}function Br(e){for(var r=1;r<e.length;r++){var n=e[r-1]+e[r]-128;e[r]=n}}function Or(e,r){for(var n=0,s=Math.floor((e.length+1)/2),c=0,u=e.length-1;!(c>u||(r[c++]=e[n++],c>u));)r[c++]=e[s++]}function Nr(e){for(var r=e.byteLength,n=new Array,s=0,c=new DataView(e);r>0;){var u=c.getInt8(s++);if(u<0){var g=-u;r-=g+1;for(var d=0;d<g;d++)n.push(c.getUint8(s++))}else{var g=u;r-=2;for(var y=c.getUint8(s++),d=0;d<g+1;d++)n.push(y)}}return n}function ct(e,r,n,s,c,u){var ne=new DataView(u.buffer),g=n[e.idx[0]].width,d=n[e.idx[0]].height,y=3,_=Math.floor(g/8),E=Math.ceil(g/8),w=Math.ceil(d/8),ce=g-(E-1)*8,I=d-(w-1)*8,R={value:0},F=new Array(y),N=new Array(y),Q=new Array(y),ee=new Array(y),he=new Array(y);for(let J=0;J<y;++J)he[J]=r[e.idx[J]],F[J]=J<1?0:F[J-1]+E*w,N[J]=new Float32Array(64),Q[J]=new Uint16Array(64),ee[J]=new Uint16Array(E*64);for(let J=0;J<w;++J){var we=8;J==w-1&&(we=I);var re=8;for(let le=0;le<E;++le){le==E-1&&(re=ce);for(let j=0;j<y;++j)Q[j].fill(0),Q[j][0]=c[F[j]++],ut(R,s,Q[j]),vt(Q[j],N[j]),ht(N[j]);dt(N);for(let j=0;j<y;++j)ft(N[j],ee[j],le*64)}let ge=0;for(let le=0;le<y;++le){const j=n[e.idx[le]].type;for(let be=8*J;be<8*J+we;++be){ge=he[le][be];for(let ze=0;ze<_;++ze){const Me=ze*64+(be&7)*8;ne.setUint16(ge+0*2*j,ee[le][Me+0],!0),ne.setUint16(ge+1*2*j,ee[le][Me+1],!0),ne.setUint16(ge+2*2*j,ee[le][Me+2],!0),ne.setUint16(ge+3*2*j,ee[le][Me+3],!0),ne.setUint16(ge+4*2*j,ee[le][Me+4],!0),ne.setUint16(ge+5*2*j,ee[le][Me+5],!0),ne.setUint16(ge+6*2*j,ee[le][Me+6],!0),ne.setUint16(ge+7*2*j,ee[le][Me+7],!0),ge+=8*2*j}}if(_!=E)for(let be=8*J;be<8*J+we;++be){const ze=he[le][be]+8*_*2*j,Me=_*64+(be&7)*8;for(let ke=0;ke<re;++ke)ne.setUint16(ze+ke*2*j,ee[le][Me+ke],!0)}}}for(var Ae=new Uint16Array(g),ne=new DataView(u.buffer),de=0;de<y;++de){n[e.idx[de]].decoded=!0;var Oe=n[e.idx[de]].type;if(n[de].type==2)for(var Qe=0;Qe<d;++Qe){const J=he[de][Qe];for(var Ie=0;Ie<g;++Ie)Ae[Ie]=ne.getUint16(J+Ie*2*Oe,!0);for(var Ie=0;Ie<g;++Ie)ne.setFloat32(J+Ie*2*Oe,x(Ae[Ie]),!0)}}}function ut(e,r,n){for(var s,c=1;c<64;)s=r[e.value],s==65280?c=64:s>>8==255?c+=s&255:(n[c]=s,c++),e.value++}function vt(e,r){r[0]=x(e[0]),r[1]=x(e[1]),r[2]=x(e[5]),r[3]=x(e[6]),r[4]=x(e[14]),r[5]=x(e[15]),r[6]=x(e[27]),r[7]=x(e[28]),r[8]=x(e[2]),r[9]=x(e[4]),r[10]=x(e[7]),r[11]=x(e[13]),r[12]=x(e[16]),r[13]=x(e[26]),r[14]=x(e[29]),r[15]=x(e[42]),r[16]=x(e[3]),r[17]=x(e[8]),r[18]=x(e[12]),r[19]=x(e[17]),r[20]=x(e[25]),r[21]=x(e[30]),r[22]=x(e[41]),r[23]=x(e[43]),r[24]=x(e[9]),r[25]=x(e[11]),r[26]=x(e[18]),r[27]=x(e[24]),r[28]=x(e[31]),r[29]=x(e[40]),r[30]=x(e[44]),r[31]=x(e[53]),r[32]=x(e[10]),r[33]=x(e[19]),r[34]=x(e[23]),r[35]=x(e[32]),r[36]=x(e[39]),r[37]=x(e[45]),r[38]=x(e[52]),r[39]=x(e[54]),r[40]=x(e[20]),r[41]=x(e[22]),r[42]=x(e[33]),r[43]=x(e[38]),r[44]=x(e[46]),r[45]=x(e[51]),r[46]=x(e[55]),r[47]=x(e[60]),r[48]=x(e[21]),r[49]=x(e[34]),r[50]=x(e[37]),r[51]=x(e[47]),r[52]=x(e[50]),r[53]=x(e[56]),r[54]=x(e[59]),r[55]=x(e[61]),r[56]=x(e[35]),r[57]=x(e[36]),r[58]=x(e[48]),r[59]=x(e[49]),r[60]=x(e[57]),r[61]=x(e[58]),r[62]=x(e[62]),r[63]=x(e[63])}function ht(e){const r=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),s=.5*Math.cos(3.14159/8),c=.5*Math.cos(3*3.14159/16),u=.5*Math.cos(5*3.14159/16),g=.5*Math.cos(3*3.14159/8),d=.5*Math.cos(7*3.14159/16);for(var y=new Array(4),_=new Array(4),E=new Array(4),w=new Array(4),ce=0;ce<8;++ce){var I=ce*8;y[0]=s*e[I+2],y[1]=g*e[I+2],y[2]=s*e[I+6],y[3]=g*e[I+6],_[0]=n*e[I+1]+c*e[I+3]+u*e[I+5]+d*e[I+7],_[1]=c*e[I+1]-d*e[I+3]-n*e[I+5]-u*e[I+7],_[2]=u*e[I+1]-n*e[I+3]+d*e[I+5]+c*e[I+7],_[3]=d*e[I+1]-u*e[I+3]+c*e[I+5]-n*e[I+7],E[0]=r*(e[I+0]+e[I+4]),E[3]=r*(e[I+0]-e[I+4]),E[1]=y[0]+y[3],E[2]=y[1]-y[2],w[0]=E[0]+E[1],w[1]=E[3]+E[2],w[2]=E[3]-E[2],w[3]=E[0]-E[1],e[I+0]=w[0]+_[0],e[I+1]=w[1]+_[1],e[I+2]=w[2]+_[2],e[I+3]=w[3]+_[3],e[I+4]=w[3]-_[3],e[I+5]=w[2]-_[2],e[I+6]=w[1]-_[1],e[I+7]=w[0]-_[0]}for(var R=0;R<8;++R)y[0]=s*e[16+R],y[1]=g*e[16+R],y[2]=s*e[48+R],y[3]=g*e[48+R],_[0]=n*e[8+R]+c*e[24+R]+u*e[40+R]+d*e[56+R],_[1]=c*e[8+R]-d*e[24+R]-n*e[40+R]-u*e[56+R],_[2]=u*e[8+R]-n*e[24+R]+d*e[40+R]+c*e[56+R],_[3]=d*e[8+R]-u*e[24+R]+c*e[40+R]-n*e[56+R],E[0]=r*(e[R]+e[32+R]),E[3]=r*(e[R]-e[32+R]),E[1]=y[0]+y[3],E[2]=y[1]-y[2],w[0]=E[0]+E[1],w[1]=E[3]+E[2],w[2]=E[3]-E[2],w[3]=E[0]-E[1],e[0+R]=w[0]+_[0],e[8+R]=w[1]+_[1],e[16+R]=w[2]+_[2],e[24+R]=w[3]+_[3],e[32+R]=w[3]-_[3],e[40+R]=w[2]-_[2],e[48+R]=w[1]-_[1],e[56+R]=w[0]-_[0]}function dt(e){for(var r=0;r<64;++r){var n=e[0][r],s=e[1][r],c=e[2][r];e[0][r]=n+1.5747*c,e[1][r]=n-.1873*s-.4682*c,e[2][r]=n+1.8556*s}}function ft(e,r,n){for(var s=0;s<64;++s)r[n+s]=We.toHalfFloat(pt(e[s]))}function pt(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(S,Math.abs(e)-1)}function kr(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function gt(e){var r=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(Nr(r)),s=new Uint8Array(n.length);return Br(n),Or(n,s),new DataView(s.buffer)}function mr(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),n=cr(r),s=new Uint8Array(n.length);return Br(n),Or(n,s),new DataView(s.buffer)}function mt(e){for(var r=e.viewer,n={value:e.offset.value},s=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),c=new Uint8Array(8192),u=0,g=new Array(e.channels),d=0;d<e.channels;d++)g[d]={},g[d].start=u,g[d].end=g[d].start,g[d].nx=e.width,g[d].ny=e.lines,g[d].size=e.type,u+=g[d].nx*g[d].ny*g[d].size;var y=Ve(r,n),_=Ve(r,n);if(_>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(y<=_)for(var d=0;d<_-y+1;d++)c[d+y]=Ze(r,n);var E=new Uint16Array(65536),w=H(c,E),ce=ye(r,n);Dr(e.array,r,n,ce,s,u);for(var d=0;d<e.channels;++d)for(var I=g[d],R=0;R<g[d].size;++R)st(s,I.start+R,I.nx,I.size,I.ny,I.nx*I.size,w);lt(E,s,u);for(var F=0,N=new Uint8Array(s.buffer.byteLength),Q=0;Q<e.lines;Q++)for(var ee=0;ee<e.channels;ee++){var I=g[ee],he=I.nx*I.size,we=new Uint8Array(s.buffer,I.end*2,he*2);N.set(we,F),F+=he*2,I.end+=he}return new DataView(N.buffer)}function wt(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),n=cr(r);const s=e.lines*e.channels*e.width,c=e.type==1?new Uint16Array(s):new Uint32Array(s);let u=0,g=0;const d=new Array(4);for(let y=0;y<e.lines;y++)for(let _=0;_<e.channels;_++){let E=0;switch(e.type){case 1:d[0]=u,d[1]=d[0]+e.width,u=d[1]+e.width;for(let w=0;w<e.width;++w){const ce=n[d[0]++]<<8|n[d[1]++];E+=ce,c[g]=E,g++}break;case 2:d[0]=u,d[1]=d[0]+e.width,d[2]=d[1]+e.width,u=d[2]+e.width;for(let w=0;w<e.width;++w){const ce=n[d[0]++]<<24|n[d[1]++]<<16|n[d[2]++]<<8;E+=ce,c[g]=E,g++}break}}return new DataView(c.buffer)}function Lr(e){var r=e.viewer,n={value:e.offset.value},s=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),c={version:xe(r,n),unknownUncompressedSize:xe(r,n),unknownCompressedSize:xe(r,n),acCompressedSize:xe(r,n),dcCompressedSize:xe(r,n),rleCompressedSize:xe(r,n),rleUncompressedSize:xe(r,n),rleRawSize:xe(r,n),totalAcUncompressedCount:xe(r,n),totalDcUncompressedCount:xe(r,n),acCompression:xe(r,n)};if(c.version<2)throw"EXRLoader.parse: "+Ke.compression+" version "+c.version+" is unsupported";for(var u=new Array,g=Ve(r,n)-2;g>0;){var d=or(r.buffer,n),y=Ze(r,n),_=y>>2&3,E=(y>>4)-1,w=new Int8Array([E])[0],ce=Ze(r,n);u.push({name:d,index:w,type:ce,compression:_}),g-=d.length+3}for(var I=Ke.channels,R=new Array(e.channels),F=0;F<e.channels;++F){var N=R[F]={},Q=I[F];N.name=Q.name,N.compression=0,N.decoded=!1,N.type=Q.pixelType,N.pLinear=Q.pLinear,N.width=e.width,N.height=e.lines}for(var ee={idx:new Array(3)},he=0;he<e.channels;++he)for(var N=R[he],F=0;F<u.length;++F){var we=u[F];N.name==we.name&&(N.compression=we.compression,we.index>=0&&(ee.idx[we.index]=he),N.offset=he)}if(c.acCompressedSize>0)switch(c.acCompression){case 0:var ne=new Uint16Array(c.totalAcUncompressedCount);Dr(e.array,r,n,c.acCompressedSize,ne,c.totalAcUncompressedCount);break;case 1:var re=e.array.slice(n.value,n.value+c.totalAcUncompressedCount),Ae=cr(re),ne=new Uint16Array(Ae.buffer);n.value+=c.totalAcUncompressedCount;break}if(c.dcCompressedSize>0){var de={array:e.array,offset:n,size:c.dcCompressedSize},Oe=new Uint16Array(mr(de).buffer);n.value+=c.dcCompressedSize}if(c.rleRawSize>0){var re=e.array.slice(n.value,n.value+c.rleCompressedSize),Ae=cr(re),Qe=Nr(Ae.buffer);n.value+=c.rleCompressedSize}for(var Ie=0,J=new Array(R.length),F=0;F<J.length;++F)J[F]=new Array;for(var ge=0;ge<e.lines;++ge)for(var le=0;le<R.length;++le)J[le].push(Ie),Ie+=R[le].width*e.type*2;ct(ee,J,R,ne,Oe,s);for(var F=0;F<R.length;++F){var N=R[F];if(!N.decoded)switch(N.compression){case 2:for(var j=0,be=0,ge=0;ge<e.lines;++ge){for(var ze=J[F][j],Me=0;Me<N.width;++Me){for(var ke=0;ke<2*N.type;++ke)s[ze++]=Qe[be+ke*N.width*N.height];be++}j++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(s.buffer)}function or(e,r){for(var n=new Uint8Array(e),s=0;n[r.value+s]!=0;)s+=1;var c=new TextDecoder().decode(n.slice(r.value,r.value+s));return r.value=r.value+s+1,c}function _t(e,r,n){var s=new TextDecoder().decode(new Uint8Array(e).slice(r.value,r.value+n));return r.value=r.value+n,s}function yt(e,r){var n=Ye(e,r),s=ye(e,r);return[n,s]}function Et(e,r){var n=ye(e,r),s=ye(e,r);return[n,s]}function Ye(e,r){var n=e.getInt32(r.value,!0);return r.value=r.value+4,n}function ye(e,r){var n=e.getUint32(r.value,!0);return r.value=r.value+4,n}function Pr(e,r){var n=e[r.value];return r.value=r.value+1,n}function Ze(e,r){var n=e.getUint8(r.value);return r.value=r.value+1,n}const xe=function(e,r){let n;return"getBigInt64"in DataView.prototype?n=Number(e.getBigInt64(r.value,!0)):n=e.getUint32(r.value+4,!0)+Number(e.getUint32(r.value,!0)<<32),r.value+=8,n};function pe(e,r){var n=e.getFloat32(r.value,!0);return r.value+=4,n}function Mt(e,r){return We.toHalfFloat(pe(e,r))}function x(e){var r=(e&31744)>>10,n=e&1023;return(e>>15?-1:1)*(r?r===31?n?NaN:1/0:Math.pow(2,r-15)*(1+n/1024):6103515625e-14*(n/1024))}function Ve(e,r){var n=e.getUint16(r.value,!0);return r.value+=2,n}function St(e,r){return x(Ve(e,r))}function xt(e,r,n,s){for(var c=n.value,u=[];n.value<c+s-1;){var g=or(r,n),d=Ye(e,n),y=Ze(e,n);n.value+=3;var _=Ye(e,n),E=Ye(e,n);u.push({name:g,pixelType:d,pLinear:y,xSampling:_,ySampling:E})}return n.value+=1,u}function It(e,r){var n=pe(e,r),s=pe(e,r),c=pe(e,r),u=pe(e,r),g=pe(e,r),d=pe(e,r),y=pe(e,r),_=pe(e,r);return{redX:n,redY:s,greenX:c,greenY:u,blueX:g,blueY:d,whiteX:y,whiteY:_}}function bt(e,r){var n=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],s=Ze(e,r);return n[s]}function Ct(e,r){var n=ye(e,r),s=ye(e,r),c=ye(e,r),u=ye(e,r);return{xMin:n,yMin:s,xMax:c,yMax:u}}function Tt(e,r){var n=["INCREASING_Y"],s=Ze(e,r);return n[s]}function Rt(e,r){var n=pe(e,r),s=pe(e,r);return[n,s]}function Ut(e,r){var n=pe(e,r),s=pe(e,r),c=pe(e,r);return[n,s,c]}function At(e,r,n,s,c){if(s==="string"||s==="stringvector"||s==="iccProfile")return _t(r,n,c);if(s==="chlist")return xt(e,r,n,c);if(s==="chromaticities")return It(e,n);if(s==="compression")return bt(e,n);if(s==="box2i")return Ct(e,n);if(s==="lineOrder")return Tt(e,n);if(s==="float")return pe(e,n);if(s==="v2f")return Rt(e,n);if(s==="v3f")return Ut(e,n);if(s==="int")return Ye(e,n);if(s==="rational")return yt(e,n);if(s==="timecode")return Et(e,n);if(s==="preview")return n.value+=c,"skipped";n.value+=c}function Ft(e,r,n){const s={};if(e.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";s.version=e.getUint8(4);const c=e.getUint8(5);s.spec={singleTile:!!(c&2),longName:!!(c&4),deepFormat:!!(c&8),multiPart:!!(c&16)},n.value=8;for(var u=!0;u;){var g=or(r,n);if(g==0)u=!1;else{var d=or(r,n),y=ye(e,n),_=At(e,r,n,d,y);_===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${d}'.`):s[g]=_}}if(c&-5)throw console.error("EXRHeader:",s),"THREE.EXRLoader: provided file is currently unsupported.";return s}function Dt(e,r,n,s,c){const u={size:0,viewer:r,array:n,offset:s,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[er?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":u.lines=1,u.uncompress=kr;break;case"RLE_COMPRESSION":u.lines=1,u.uncompress=gt;break;case"ZIPS_COMPRESSION":u.lines=1,u.uncompress=mr;break;case"ZIP_COMPRESSION":u.lines=16,u.uncompress=mr;break;case"PIZ_COMPRESSION":u.lines=32,u.uncompress=mt;break;case"PXR24_COMPRESSION":u.lines=16,u.uncompress=wt;break;case"DWAA_COMPRESSION":u.lines=32,u.uncompress=Lr;break;case"DWAB_COMPRESSION":u.lines=256,u.uncompress=Lr;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(u.scanlineBlockSize=u.lines,u.type==1)switch(c){case Ne:u.getter=St,u.inputSize=2;break;case Te:u.getter=Ve,u.inputSize=2;break}else if(u.type==2)switch(c){case Ne:u.getter=pe,u.inputSize=4;break;case Te:u.getter=Mt,u.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+u.type+" for "+e.compression+".";u.blockCount=(e.dataWindow.yMax+1)/u.scanlineBlockSize;for(var g=0;g<u.blockCount;g++)xe(r,s);u.outputChannels=u.channels==3?4:u.channels;const d=u.width*u.height*u.outputChannels;switch(c){case Ne:u.byteArray=new Float32Array(d),u.channels<u.outputChannels&&u.byteArray.fill(1,0,d);break;case Te:u.byteArray=new Uint16Array(d),u.channels<u.outputChannels&&u.byteArray.fill(15360,0,d);break;default:console.error("THREE.EXRLoader: unsupported type: ",c);break}return u.bytesPerLine=u.width*u.inputSize*u.channels,u.outputChannels==4?u.format=nr:u.format=Wt,er?u.colorSpace="srgb-linear":u.encoding=3e3,u}const lr=new DataView(t),Bt=new Uint8Array(t),qe={value:0},Ke=Ft(lr,t,qe),P=Dt(Ke,lr,Bt,qe,this.type),Hr={value:0},Ot={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<P.height/P.scanlineBlockSize;e++){const r=ye(lr,qe);P.size=ye(lr,qe),P.lines=r+P.scanlineBlockSize>P.height?P.height-r:P.scanlineBlockSize;const s=P.size<P.lines*P.bytesPerLine?P.uncompress(P):kr(P);qe.value+=P.size;for(let c=0;c<P.scanlineBlockSize;c++){const u=c+e*P.scanlineBlockSize;if(u>=P.height)break;for(let g=0;g<P.channels;g++){const d=Ot[Ke.channels[g].name];for(let y=0;y<P.width;y++){Hr.value=(c*(P.channels*P.width)+g*P.width+y)*P.inputSize;const _=(P.height-1-u)*(P.width*P.outputChannels)+y*P.outputChannels+d;P.byteArray[_]=P.getter(s,Hr)}}}}return{header:Ke,width:P.width,height:P.height,data:P.byteArray,format:P.format,[er?"colorSpace":"encoding"]:P[er?"colorSpace":"encoding"],type:this.type}}setDataType(t){return this.type=t,this}load(t,a,o,l){function h(v,p){er?v.colorSpace=p.colorSpace:v.encoding=p.encoding,v.minFilter=Fe,v.magFilter=Fe,v.generateMipmaps=!1,v.flipY=!1,a&&a(v,p)}return super.load(t,h,o,l)}}const Aa=3e3,Fa=3001,et=(i,t,a)=>{let o;switch(i){case Er:o=new Uint8ClampedArray(t*a*4);break;case Te:o=new Uint16Array(t*a*4);break;case Qt:o=new Uint32Array(t*a*4);break;case Kt:o=new Int8Array(t*a*4);break;case qt:o=new Int16Array(t*a*4);break;case Vt:o=new Int32Array(t*a*4);break;case Ne:o=new Float32Array(t*a*4);break;default:throw new Error("Unsupported data type")}return o};let ur;const Da=(i,t,a,o)=>{if(ur!==void 0)return ur;const l=new hr(1,1,o);t.setRenderTarget(l);const h=new pr(new xr,new Yt({color:16777215}));t.render(h,a),t.setRenderTarget(null);const v=et(i,l.width,l.height);return t.readRenderTargetPixels(l,0,0,l.width,l.height,v),l.dispose(),h.geometry.dispose(),h.material.dispose(),ur=v[0]!==0,ur};class br{constructor(t){ue(this,"_renderer");ue(this,"_rendererIsDisposable",!1);ue(this,"_material");ue(this,"_scene");ue(this,"_camera");ue(this,"_quad");ue(this,"_renderTarget");ue(this,"_width");ue(this,"_height");ue(this,"_type");ue(this,"_colorSpace");ue(this,"_supportsReadPixels",!0);ue(this,"render",()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(t){throw this._renderer.setRenderTarget(null),t}this._renderer.setRenderTarget(null)});var o,l,h,v,p,f,m,b,T,U,k,z,se,O,Z,X;this._width=t.width,this._height=t.height,this._type=t.type,this._colorSpace=t.colorSpace;const a={format:nr,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((o=t.renderTargetOptions)==null?void 0:o.anisotropy)!==void 0?(l=t.renderTargetOptions)==null?void 0:l.anisotropy:1,generateMipmaps:((h=t.renderTargetOptions)==null?void 0:h.generateMipmaps)!==void 0?(v=t.renderTargetOptions)==null?void 0:v.generateMipmaps:!1,magFilter:((p=t.renderTargetOptions)==null?void 0:p.magFilter)!==void 0?(f=t.renderTargetOptions)==null?void 0:f.magFilter:Fe,minFilter:((m=t.renderTargetOptions)==null?void 0:m.minFilter)!==void 0?(b=t.renderTargetOptions)==null?void 0:b.minFilter:Fe,samples:((T=t.renderTargetOptions)==null?void 0:T.samples)!==void 0?(U=t.renderTargetOptions)==null?void 0:U.samples:void 0,wrapS:((k=t.renderTargetOptions)==null?void 0:k.wrapS)!==void 0?(z=t.renderTargetOptions)==null?void 0:z.wrapS:Pe,wrapT:((se=t.renderTargetOptions)==null?void 0:se.wrapT)!==void 0?(O=t.renderTargetOptions)==null?void 0:O.wrapT:Pe};if(this._material=t.material,t.renderer?this._renderer=t.renderer:(this._renderer=br.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Xr,this._camera=new $t,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!Da(this._type,this._renderer,this._camera,a)){let ae;switch(this._type){case Te:ae=this._renderer.extensions.has("EXT_color_buffer_float")?Ne:void 0;break}ae!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Ne}`),this._type=ae):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new pr(new xr,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new hr(this.width,this.height,a),this._renderTarget.texture.mapping=((Z=t.renderTargetOptions)==null?void 0:Z.mapping)!==void 0?(X=t.renderTargetOptions)==null?void 0:X.mapping:dr}static instantiateRenderer(){const t=new Xt;return t.setSize(128,128),t}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const t=et(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,t),t}toDataTexture(t){const a=new jt(this.toArray(),this.width,this.height,nr,this._type,(t==null?void 0:t.mapping)||dr,(t==null?void 0:t.wrapS)||Pe,(t==null?void 0:t.wrapT)||Pe,(t==null?void 0:t.magFilter)||Fe,(t==null?void 0:t.minFilter)||Fe,(t==null?void 0:t.anisotropy)||1,yr);return a.generateMipmaps=(t==null?void 0:t.generateMipmaps)!==void 0?t==null?void 0:t.generateMipmaps:!1,a}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(t){this.disposeOnDemandRenderer(),t&&this.renderTarget.dispose(),this.material instanceof ar&&Object.values(this.material.uniforms).forEach(a=>{a.value instanceof $e&&a.value.dispose()}),Object.values(this.material).forEach(a=>{a instanceof $e&&a.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(t){this._width=t,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(t){this._height=t,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(t){this._renderTarget=t,this._width=t.width,this._height=t.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class rt extends Error{}class tt extends Error{}const rr=(i,t,a)=>{const o=new RegExp(`${t}="([^"]*)"`,"i").exec(i);if(o)return o[1];const l=new RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(i);if(l){const h=l[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return h&&h.length===3?h.map(v=>v.replace(/<\/?rdf:li>/g,"")):l[1].trim()}if(a!==void 0)return a;throw new Error(`Can't find ${t} in gainmap metadata`)},Ba=i=>{let t;typeof TextDecoder<"u"?t=new TextDecoder().decode(i):t=i.toString();let a=t.indexOf("<x:xmpmeta");for(;a!==-1;){const o=t.indexOf("x:xmpmeta>",a),l=t.slice(a,o+10);try{const h=rr(l,"hdrgm:GainMapMin","0"),v=rr(l,"hdrgm:GainMapMax"),p=rr(l,"hdrgm:Gamma","1"),f=rr(l,"hdrgm:OffsetSDR","0.015625"),m=rr(l,"hdrgm:OffsetHDR","0.015625"),b=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(l),T=b?b[1]:"0",U=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(l);if(!U)throw new Error("Incomplete gainmap metadata");const k=U[1];return{gainMapMin:Array.isArray(h)?h.map(z=>parseFloat(z)):[parseFloat(h),parseFloat(h),parseFloat(h)],gainMapMax:Array.isArray(v)?v.map(z=>parseFloat(z)):[parseFloat(v),parseFloat(v),parseFloat(v)],gamma:Array.isArray(p)?p.map(z=>parseFloat(z)):[parseFloat(p),parseFloat(p),parseFloat(p)],offsetSdr:Array.isArray(f)?f.map(z=>parseFloat(z)):[parseFloat(f),parseFloat(f),parseFloat(f)],offsetHdr:Array.isArray(m)?m.map(z=>parseFloat(z)):[parseFloat(m),parseFloat(m),parseFloat(m)],hdrCapacityMin:parseFloat(T),hdrCapacityMax:parseFloat(k)}}catch{}a=t.indexOf("<x:xmpmeta",o)}};class Oa{constructor(t){ue(this,"options");this.options={debug:t&&t.debug!==void 0?t.debug:!1,extractFII:t&&t.extractFII!==void 0?t.extractFII:!0,extractNonFII:t&&t.extractNonFII!==void 0?t.extractNonFII:!0}}extract(t){return new Promise((a,o)=>{const l=this.options.debug,h=new DataView(t.buffer);if(h.getUint16(0)!==65496){o(new Error("Not a valid jpeg"));return}const v=h.byteLength;let p=2,f=0,m;for(;p<v;){if(++f>250){o(new Error(`Found no marker after ${f} loops ðŸ˜µ`));return}if(h.getUint8(p)!==255){o(new Error(`Not a valid marker at offset 0x${p.toString(16)}, found: 0x${h.getUint8(p).toString(16)}`));return}if(m=h.getUint8(p+1),l&&console.log(`Marker: ${m.toString(16)}`),m===226){l&&console.log("Found APP2 marker (0xffe2)");const b=p+4;if(h.getUint32(b)===1297106432){const T=b+4;let U;if(h.getUint16(T)===18761)U=!1;else if(h.getUint16(T)===19789)U=!0;else{o(new Error("No valid endianness marker found in TIFF header"));return}if(h.getUint16(T+2,!U)!==42){o(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const k=h.getUint32(T+4,!U);if(k<8){o(new Error("Not valid TIFF data! (First offset less than 8)"));return}const z=T+k,se=h.getUint16(z,!U),O=z+2;let Z=0;for(let W=O;W<O+12*se;W+=12)h.getUint16(W,!U)===45057&&(Z=h.getUint32(W+8,!U));const ae=z+2+se*12+4,ve=[];for(let W=ae;W<ae+Z*16;W+=16){const A={MPType:h.getUint32(W,!U),size:h.getUint32(W+4,!U),dataOffset:h.getUint32(W+8,!U),dependantImages:h.getUint32(W+12,!U),start:-1,end:-1,isFII:!1};A.dataOffset?(A.start=T+A.dataOffset,A.isFII=!1):(A.start=0,A.isFII=!0),A.end=A.start+A.size,ve.push(A)}if(this.options.extractNonFII&&ve.length){const W=new Blob([h]),A=[];for(const Y of ve){if(Y.isFII&&!this.options.extractFII)continue;const M=W.slice(Y.start,Y.end+1,"image/jpeg");A.push(M)}a(A)}}}p+=2+h.getUint16(p+2)}})}}const Na=async i=>{const t=Ba(i);if(!t)throw new tt("Gain map XMP metadata not found");const o=await new Oa({extractFII:!0,extractNonFII:!0}).extract(i);if(o.length!==2)throw new rt("Gain map recovery image not found");return{sdr:new Uint8Array(await o[0].arrayBuffer()),gainMap:new Uint8Array(await o[1].arrayBuffer()),metadata:t}},Zr=i=>new Promise((t,a)=>{const o=document.createElement("img");o.onload=()=>{t(o)},o.onerror=l=>{a(l)},o.src=URL.createObjectURL(i)});class ka extends Jt{constructor(a,o){super(o);ue(this,"_renderer");ue(this,"_renderTargetOptions");ue(this,"_internalLoadingManager");ue(this,"_config");this._config=a,a.renderer&&(this._renderer=a.renderer),this._internalLoadingManager=new ea}setRenderer(a){return this._renderer=a,this}setRenderTargetOptions(a){return this._renderTargetOptions=a,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: A Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const a=this._config.createMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new $e,sdr:new $e});return this._config.createQuadRenderer({width:16,height:16,type:Te,colorSpace:yr,material:a,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async processImages(a,o,l){const h=o?new Blob([o],{type:"image/jpeg"}):void 0,v=new Blob([a],{type:"image/jpeg"});let p,f,m=!1;if(typeof createImageBitmap>"u"){const b=await Promise.all([h?Zr(h):Promise.resolve(void 0),Zr(v)]);f=b[0],p=b[1],m=l==="flipY"}else{const b=await Promise.all([h?createImageBitmap(h,{imageOrientation:l||"flipY"}):Promise.resolve(void 0),createImageBitmap(v,{imageOrientation:l||"flipY"})]);f=b[0],p=b[1]}return{sdrImage:p,gainMapImage:f,needsFlip:m}}createTextures(a,o,l){const h=new $e(o||new ImageData(2,2),dr,Pe,Pe,Fe,zr,nr,Er,1,yr);h.flipY=l,h.needsUpdate=!0;const v=new $e(a,dr,Pe,Pe,Fe,zr,nr,Er,1,ra);return v.flipY=l,v.needsUpdate=!0,{gainMap:h,sdr:v}}updateQuadRenderer(a,o,l,h,v){a.width=o.width,a.height=o.height,a.material.gainMap=l,a.material.sdr=h,a.material.gainMapMin=v.gainMapMin,a.material.gainMapMax=v.gainMapMax,a.material.offsetHdr=v.offsetHdr,a.material.offsetSdr=v.offsetSdr,a.material.gamma=v.gamma,a.material.hdrCapacityMin=v.hdrCapacityMin,a.material.hdrCapacityMax=v.hdrCapacityMax,a.material.maxDisplayBoost=Math.pow(2,v.hdrCapacityMax),a.material.needsUpdate=!0}}const La=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Pa=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class Ha extends ar{constructor({gamma:a,offsetHdr:o,offsetSdr:l,gainMapMin:h,gainMapMax:v,maxDisplayBoost:p,hdrCapacityMin:f,hdrCapacityMax:m,sdr:b,gainMap:T}){super({name:"GainMapDecoderMaterial",vertexShader:La,fragmentShader:Pa,uniforms:{sdr:{value:b},gainMap:{value:T},gamma:{value:new Je(1/a[0],1/a[1],1/a[2])},offsetHdr:{value:new Je().fromArray(o)},offsetSdr:{value:new Je().fromArray(l)},gainMapMin:{value:new Je().fromArray(h)},gainMapMax:{value:new Je().fromArray(v)},weightFactor:{value:(Math.log2(p)-f)/(m-f)}},blending:ta,depthTest:!1,depthWrite:!1});ue(this,"_maxDisplayBoost");ue(this,"_hdrCapacityMin");ue(this,"_hdrCapacityMax");this._maxDisplayBoost=p,this._hdrCapacityMin=f,this._hdrCapacityMax=m,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(a){this.uniforms.sdr.value=a}get gainMap(){return this.uniforms.gainMap.value}set gainMap(a){this.uniforms.gainMap.value=a}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(a){this.uniforms.offsetHdr.value.fromArray(a)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(a){this.uniforms.offsetSdr.value.fromArray(a)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(a){this.uniforms.gainMapMin.value.fromArray(a)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(a){this.uniforms.gainMapMax.value.fromArray(a)}get gamma(){const a=this.uniforms.gamma.value;return[1/a.x,1/a.y,1/a.z]}set gamma(a){const o=this.uniforms.gamma.value;o.x=1/a[0],o.y=1/a[1],o.z=1/a[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(a){this._hdrCapacityMin=a,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(a){this._hdrCapacityMax=a,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(a){this._maxDisplayBoost=Math.max(1,Math.min(65504,a)),this.calculateWeight()}calculateWeight(){const a=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,a))}}class at extends ka{constructor(t,a){super({renderer:t,createMaterial:o=>new Ha(o),createQuadRenderer:o=>new br(o)},a)}async render(t,a,o,l){const{sdrImage:h,gainMapImage:v,needsFlip:p}=await this.processImages(o,l,"flipY"),{gainMap:f,sdr:m}=this.createTextures(h,v,p);this.updateQuadRenderer(t,h,f,m,a),t.render()}}class za extends at{load([t,a,o],l,h,v){const p=this.prepareQuadRenderer();let f,m,b;const T=async()=>{if(f&&m&&b){try{await this.render(p,b,f,m)}catch(S){this.manager.itemError(t),this.manager.itemError(a),this.manager.itemError(o),typeof v=="function"&&v(S),p.disposeOnDemandRenderer();return}typeof l=="function"&&l(p),this.manager.itemEnd(t),this.manager.itemEnd(a),this.manager.itemEnd(o),p.disposeOnDemandRenderer()}};let U=!0,k=0,z=0,se=!0,O=0,Z=0,X=!0,ae=0,ve=0;const W=()=>{if(typeof h=="function"){const S=k+O+ae,H=z+Z+ve,$=U&&se&&X;h(new ProgressEvent("progress",{lengthComputable:$,loaded:H,total:S}))}};this.manager.itemStart(t),this.manager.itemStart(a),this.manager.itemStart(o);const A=new vr(this._internalLoadingManager);A.setResponseType("arraybuffer"),A.setRequestHeader(this.requestHeader),A.setPath(this.path),A.setWithCredentials(this.withCredentials),A.load(t,async S=>{if(typeof S=="string")throw new Error("Invalid sdr buffer");f=S,await T()},S=>{U=S.lengthComputable,z=S.loaded,k=S.total,W()},S=>{this.manager.itemError(t),typeof v=="function"&&v(S)});const Y=new vr(this._internalLoadingManager);Y.setResponseType("arraybuffer"),Y.setRequestHeader(this.requestHeader),Y.setPath(this.path),Y.setWithCredentials(this.withCredentials),Y.load(a,async S=>{if(typeof S=="string")throw new Error("Invalid gainmap buffer");m=S,await T()},S=>{se=S.lengthComputable,Z=S.loaded,O=S.total,W()},S=>{this.manager.itemError(a),typeof v=="function"&&v(S)});const M=new vr(this._internalLoadingManager);return M.setRequestHeader(this.requestHeader),M.setPath(this.path),M.setWithCredentials(this.withCredentials),M.load(o,async S=>{if(typeof S!="string")throw new Error("Invalid metadata string");b=JSON.parse(S),await T()},S=>{X=S.lengthComputable,ve=S.loaded,ae=S.total,W()},S=>{this.manager.itemError(o),typeof v=="function"&&v(S)}),p}}class Ga extends at{load(t,a,o,l){const h=this.prepareQuadRenderer(),v=new vr(this._internalLoadingManager);return v.setResponseType("arraybuffer"),v.setRequestHeader(this.requestHeader),v.setPath(this.path),v.setWithCredentials(this.withCredentials),this.manager.itemStart(t),v.load(t,async p=>{if(typeof p=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const f=new Uint8Array(p);let m,b,T;try{const U=await Na(f);m=U.sdr,b=U.gainMap,T=U.metadata}catch(U){if(U instanceof tt||U instanceof rt)console.warn(`Failure to reconstruct an HDR image from ${t}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),T={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},m=f;else throw U}try{await this.render(h,T,m.buffer,b==null?void 0:b.buffer)}catch(U){this.manager.itemError(t),typeof l=="function"&&l(U),h.disposeOnDemandRenderer();return}typeof a=="function"&&a(h),this.manager.itemEnd(t),h.disposeOnDemandRenderer()},o,p=>{this.manager.itemError(t),typeof l=="function"&&l(p)}),h}}const ir={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},nt="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Xe=i=>Array.isArray(i),Cr=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function gr({files:i=Cr,path:t="",preset:a=void 0,encoding:o=void 0,extensions:l}={}){let h=null,v=!1;a&&(Tr(a),i=ir[a],t=nt),v=Xe(i);const{extension:p,isCubemap:f}=Rr(i);if(h=Ur(p),!h)throw new Error("useEnvironment: Unrecognized file extension: "+i);const m=Ge(k=>k.gl);B.useLayoutEffect(()=>{if(p!=="webp"&&p!=="jpg"&&p!=="jpeg")return;function k(){fr.clear(h,v?[i]:i)}m.domElement.addEventListener("webglcontextlost",k,{once:!0})},[i,m.domElement]);const b=fr(h,v?[i]:i,k=>{(p==="webp"||p==="jpg"||p==="jpeg")&&k.setRenderer(m),k.setPath==null||k.setPath(t),l&&l(k)});let T=v?b[0]:b;if(p==="jpg"||p==="jpeg"||p==="webp"){var U;T=(U=T.renderTarget)==null?void 0:U.texture}return T.mapping=f?aa:na,"colorSpace"in T?T.colorSpace=o??f?"srgb":"srgb-linear":T.encoding=o??f?Fa:Aa,T}const Za={files:Cr,path:"",preset:void 0,extensions:void 0};gr.preload=i=>{const t={...Za,...i};let{files:a,path:o=""}=t;const{preset:l,extensions:h}=t;l&&(Tr(l),a=ir[l],o=nt);const{extension:v}=Rr(a);if(v==="webp"||v==="jpg"||v==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const p=Ur(v);if(!p)throw new Error("useEnvironment: Unrecognized file extension: "+a);fr.preload(p,Xe(a)?[a]:a,f=>{f.setPath==null||f.setPath(o),h&&h(f)})};const Wa={files:Cr,preset:void 0};gr.clear=i=>{const t={...Wa,...i};let{files:a}=t;const{preset:o}=t;o&&(Tr(o),a=ir[o]);const{extension:l}=Rr(a),h=Ur(l);if(!h)throw new Error("useEnvironment: Unrecognized file extension: "+a);fr.clear(h,Xe(a)?[a]:a)};function Tr(i){if(!(i in ir))throw new Error("Preset must be one of: "+Object.keys(ir).join(", "))}function Rr(i){var t;const a=Xe(i)&&i.length===6,o=Xe(i)&&i.length===3&&i.some(v=>v.endsWith("json")),l=Xe(i)?i[0]:i;return{extension:a?"cube":o?"webp":l.startsWith("data:application/exr")?"exr":l.startsWith("data:application/hdr")?"hdr":l.startsWith("data:image/jpeg")?"jpg":(t=l.split(".").pop())==null||(t=t.split("?"))==null||(t=t.shift())==null?void 0:t.toLowerCase(),isCubemap:a,isGainmap:o}}function Ur(i){return i==="cube"?ia:i==="hdr"?Ra:i==="exr"?Ua:i==="jpg"||i==="jpeg"?Ga:i==="webp"?za:null}const $a=i=>i.current&&i.current.isScene,Xa=i=>$a(i)?i.current:i;function Ar(i,t,a,o,l={}){var h,v,p,f;l={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...l};const m=Xa(t||a),b=m.background,T=m.environment,U={backgroundBlurriness:m.backgroundBlurriness,backgroundIntensity:m.backgroundIntensity,backgroundRotation:(h=(v=m.backgroundRotation)==null||v.clone==null?void 0:v.clone())!==null&&h!==void 0?h:[0,0,0],environmentIntensity:m.environmentIntensity,environmentRotation:(p=(f=m.environmentRotation)==null||f.clone==null?void 0:f.clone())!==null&&p!==void 0?p:[0,0,0]};return i!=="only"&&(m.environment=o),i&&(m.background=o),Gr(m,l),()=>{i!=="only"&&(m.environment=T),i&&(m.background=b),Gr(m,U)}}function Fr({scene:i,background:t=!1,map:a,...o}){const l=Ge(h=>h.scene);return B.useLayoutEffect(()=>{if(a)return Ar(t,i,l,a,o)}),null}function it({background:i=!1,scene:t,blur:a,backgroundBlurriness:o,backgroundIntensity:l,backgroundRotation:h,environmentIntensity:v,environmentRotation:p,...f}){const m=gr(f),b=Ge(T=>T.scene);return B.useLayoutEffect(()=>Ar(i,t,b,m,{backgroundBlurriness:a??o,backgroundIntensity:l,backgroundRotation:h,environmentIntensity:v,environmentRotation:p})),B.useEffect(()=>()=>{m.dispose()},[m]),null}function ja({children:i,near:t=.1,far:a=1e3,resolution:o=256,frames:l=1,map:h,background:v=!1,blur:p,backgroundBlurriness:f,backgroundIntensity:m,backgroundRotation:b,environmentIntensity:T,environmentRotation:U,scene:k,files:z,path:se,preset:O=void 0,extensions:Z}){const X=Ge(M=>M.gl),ae=Ge(M=>M.scene),ve=B.useRef(null),[W]=B.useState(()=>new Xr),A=B.useMemo(()=>{const M=new oa(o);return M.texture.type=Te,M},[o]);B.useEffect(()=>()=>{A.dispose()},[A]),B.useLayoutEffect(()=>{if(l===1){const M=X.autoClear;X.autoClear=!0,ve.current.update(X,W),X.autoClear=M}return Ar(v,k,ae,A.texture,{backgroundBlurriness:p??f,backgroundIntensity:m,backgroundRotation:b,environmentIntensity:T,environmentRotation:U})},[i,W,A.texture,k,ae,v,l,X]);let Y=1;return Ir(()=>{if(l===1/0||Y<l){const M=X.autoClear;X.autoClear=!0,ve.current.update(X,W),X.autoClear=M,Y++}}),B.createElement(B.Fragment,null,la(B.createElement(B.Fragment,null,i,B.createElement("cubeCamera",{ref:ve,args:[t,a,A]}),z||O?B.createElement(it,{background:!0,files:z,preset:O,path:se,extensions:Z}):h?B.createElement(Fr,{background:!0,map:h,extensions:Z}):null),W))}function Ya(i){var t,a,o,l;const h=gr(i),v=i.map||h;B.useMemo(()=>sa({GroundProjectedEnvImpl:ba}),[]),B.useEffect(()=>()=>{h.dispose()},[h]);const p=B.useMemo(()=>[v],[v]),f=(t=i.ground)==null?void 0:t.height,m=(a=i.ground)==null?void 0:a.radius,b=(o=(l=i.ground)==null?void 0:l.scale)!==null&&o!==void 0?o:1e3;return B.createElement(B.Fragment,null,B.createElement(Fr,Wr({},i,{map:v})),B.createElement("groundProjectedEnvImpl",{args:p,scale:b,height:f,radius:m}))}function Va(i){return i.ground?B.createElement(Ya,i):i.map?B.createElement(Fr,i):i.children?B.createElement(ja,i):B.createElement(it,i)}const qa=B.forwardRef(({scale:i=10,frames:t=1/0,opacity:a=1,width:o=1,height:l=1,blur:h=1,near:v=0,far:p=10,resolution:f=512,smooth:m=!0,color:b="#000000",depthWrite:T=!1,renderOrder:U,...k},z)=>{const se=B.useRef(null),O=Ge(C=>C.scene),Z=Ge(C=>C.gl),X=B.useRef(null);o=o*(Array.isArray(i)?i[0]:i||1),l=l*(Array.isArray(i)?i[1]:i||1);const[ae,ve,W,A,Y,M,S]=B.useMemo(()=>{const C=new hr(f,f),q=new hr(f,f);q.texture.generateMipmaps=C.texture.generateMipmaps=!1;const D=new xr(o,l).rotateX(Math.PI/2),Ee=new pr(D),Se=new ca;Se.depthTest=Se.depthWrite=!1,Se.onBeforeCompile=me=>{me.uniforms={...me.uniforms,ucolor:{value:new ua(b)}},me.fragmentShader=me.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),me.fragmentShader=me.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const _e=new ar(Ca),V=new ar(Ta);return V.depthTest=_e.depthTest=!1,[C,D,Se,Ee,_e,V,q]},[f,o,l,i,b]),H=C=>{A.visible=!0,A.material=Y,Y.uniforms.tDiffuse.value=ae.texture,Y.uniforms.h.value=C*1/256,Z.setRenderTarget(S),Z.render(A,X.current),A.material=M,M.uniforms.tDiffuse.value=S.texture,M.uniforms.v.value=C*1/256,Z.setRenderTarget(ae),Z.render(A,X.current),A.visible=!1};let $=0,L,G;return Ir(()=>{X.current&&(t===1/0||$<t)&&($++,L=O.background,G=O.overrideMaterial,se.current.visible=!1,O.background=null,O.overrideMaterial=W,Z.setRenderTarget(ae),Z.render(O,X.current),H(h),m&&H(h*.4),Z.setRenderTarget(null),se.current.visible=!0,O.overrideMaterial=G,O.background=L)}),B.useImperativeHandle(z,()=>se.current,[]),B.createElement("group",Wr({"rotation-x":Math.PI/2},k,{ref:se}),B.createElement("mesh",{renderOrder:U,geometry:ve,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},B.createElement("meshBasicMaterial",{transparent:!0,map:ae.texture,opacity:a,depthWrite:T})),B.createElement("orthographicCamera",{ref:X,args:[-o/2,o/2,l/2,-l/2,v,p]}))});function Ka(i){const t=B.useRef(),[a,o]=B.useState(!1),[l,h]=B.useState(!1);return Ir((v,p)=>{t.current.rotation.x+=p*.5,t.current.rotation.y+=p*.2}),te.jsx(va,{speed:2,rotationIntensity:.5,floatIntensity:1,children:te.jsxs("mesh",{...i,ref:t,scale:l?1.2:1,onClick:()=>h(!l),onPointerOver:()=>o(!0),onPointerOut:()=>o(!1),children:[te.jsx("sphereGeometry",{args:[1,32,32]}),te.jsx("meshStandardMaterial",{color:a?"#FFD369":"white",roughness:.3,metalness:.1}),te.jsxs("mesh",{rotation:[Math.PI/2,0,0],children:[te.jsx("torusGeometry",{args:[1.01,.05,16,100]}),te.jsx("meshBasicMaterial",{color:"#1CA9C9"})]}),te.jsxs("mesh",{rotation:[0,Math.PI/2,0],children:[te.jsx("torusGeometry",{args:[1.01,.05,16,100]}),te.jsx("meshBasicMaterial",{color:"#1CA9C9"})]})]})})}function on(){return te.jsxs(te.Fragment,{children:[te.jsx(Lt,{title:"Exp 1: Floating Ball"}),te.jsxs("div",{className:"h-screen w-full bg-gradient-to-b from-blue-400 to-blue-200",children:[te.jsx(zt,{}),te.jsxs(Pt,{camera:{position:[0,0,5],fov:50},children:[te.jsx("ambientLight",{intensity:.5}),te.jsx("spotLight",{position:[10,10,10],angle:.15,penumbra:1,intensity:1,castShadow:!0}),te.jsx("pointLight",{position:[-10,-10,-10],intensity:.5}),te.jsx(Ka,{position:[0,0,0]}),te.jsx(qa,{position:[0,-2,0],opacity:.5,scale:10,blur:2.5,far:4}),te.jsx(Va,{preset:"sunset"}),te.jsx(Ht,{enableZoom:!1})]}),te.jsxs("div",{className:"absolute bottom-10 left-0 w-full text-center pointer-events-none",children:[te.jsx("h1",{className:"text-4xl font-extrabold text-white drop-shadow-lg",children:"Experiencia 1: El BalÃ³n"}),te.jsx("p",{className:"text-white/90 text-lg mt-2",children:"InteractÃºa con el elemento central del juego."})]})]})]})}export{on as default};
